<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ doc.metadata.database_name }} - Database Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .header { background: #f4f4f4; padding: 20px; border-radius: 5px; margin-bottom: 30px; }
        .section { margin-bottom: 30px; }
        .table-container { overflow-x: auto; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        .schema-section { margin-bottom: 40px; border: 1px solid #ddd; padding: 20px; border-radius: 5px; }
        .table-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 3px; }
        .column-list { margin: 10px 0; }
        .constraint-info { font-size: 0.9em; color: #666; margin: 5px 0; }
        .toc { background: #f9f9f9; padding: 20px; border-radius: 5px; margin-bottom: 30px; }
        .toc ul { list-style-type: none; padding-left: 20px; }
        .toc a { text-decoration: none; color: #007acc; }
        .toc a:hover { text-decoration: underline; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-box { background: #f0f8ff; padding: 15px; border-radius: 5px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; color: #007acc; }
    </style>
</head>
<body>
    <div class="header">
        <h1>{{ doc.metadata.database_name }} - Database Documentation</h1>
        <p><strong>Server:</strong> {{ doc.metadata.server_name }}</p>
        <p><strong>Generated:</strong> {{ doc.metadata.extraction_date | format_date }}</p>
        <p><strong>Size:</strong> {{ doc.metadata.used_mb | format_number }} MB used of {{ doc.metadata.size_mb | format_number }} MB allocated</p>
    </div>

    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li><a href="#overview">Database Overview</a></li>
            <li><a href="#schemas">Schemas</a></li>
            <li><a href="#tables">Tables</a></li>
            <li><a href="#views">Views</a></li>
            <li><a href="#procedures">Stored Procedures</a></li>
            <li><a href="#functions">Functions</a></li>
            <li><a href="#relationships">Relationships</a></li>
        </ul>
    </div>

    <div id="overview" class="section">
        <h2>Database Overview</h2>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-number">{{ doc.statistics.total_schemas }}</div>
                <div>Schemas</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">{{ doc.statistics.total_tables }}</div>
                <div>Tables</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">{{ doc.statistics.total_views }}</div>
                <div>Views</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">{{ doc.statistics.total_procedures }}</div>
                <div>Stored Procedures</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">{{ doc.statistics.total_functions }}</div>
                <div>Functions</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">{{ doc.statistics.total_rows | format_number }}</div>
                <div>Total Rows</div>
            </div>
        </div>
    </div>

    <div id="schemas" class="section">
        <h2>Schemas</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Schema Name</th>
                        <th>Principal</th>
                    </tr>
                </thead>
                <tbody>
                    {% for schema in doc.schemas %}
                    <tr>
                        <td>{{ schema.name }}</td>
                        <td>{{ schema.principal }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="tables" class="section">
        <h2>Tables</h2>
        {% for table in doc.tables %}
        <div class="table-section">
            <h3>{{ table.schema_name }}.{{ table.table_name }}</h3>
            {% if table.description %}
            <p><strong>Description:</strong> {{ table.description }}</p>
            {% endif %}
            <p><strong>Rows:</strong> {{ table.row_count | format_number }}</p>
            
            <h4>Columns</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Data Type</th>
                            <th>Nullable</th>
                            <th>Identity</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for column in table.columns %}
                        <tr>
                            <td>{{ column.name }}</td>
                            <td>{{ column.data_type }}</td>
                            <td>{{ 'Yes' if column.is_nullable else 'No' }}</td>
                            <td>{{ 'Yes' if column.is_identity else 'No' }}</td>
                            <td>{{ column.default_value }}</td>
                            <td>{{ column.description }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% if table.primary_keys %}
            <div class="constraint-info">
                <strong>Primary Key:</strong> {{ table.primary_keys | map(attribute='column_name') | join(', ') }}
            </div>
            {% endif %}

            {% if table.foreign_keys %}
            <div class="constraint-info">
                <strong>Foreign Keys:</strong>
                {% for fk in table.foreign_keys %}
                <div>{{ fk.parent_column }} â†’ {{ fk.referenced_schema }}.{{ fk.referenced_table }}.{{ fk.referenced_column }}</div>
                {% endfor %}
            </div>
            {% endif %}

            {% if table.indexes %}
            <div class="constraint-info">
                <strong>Indexes:</strong>
                {% for idx in table.indexes %}
                <div>{{ idx.index_name }} ({{ idx.index_type }}): {{ idx.columns }}</div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <div id="views" class="section">
        <h2>Views</h2>
        {% for view in doc.views %}
        <div class="table-section">
            <h3>{{ view.schema_name }}.{{ view.view_name }}</h3>
            {% if view.description %}
            <p><strong>Description:</strong> {{ view.description }}</p>
            {% endif %}
            
            <h4>Columns</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Data Type</th>
                            <th>Nullable</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for column in view.columns %}
                        <tr>
                            <td>{{ column.name }}</td>
                            <td>{{ column.data_type }}</td>
                            <td>{{ 'Yes' if column.is_nullable else 'No' }}</td>
                            <td>{{ column.description }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>

    <div id="procedures" class="section">
        <h2>Stored Procedures</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Schema</th>
                        <th>Procedure Name</th>
                        <th>Created</th>
                        <th>Modified</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for proc in doc.stored_procedures %}
                    <tr>
                        <td>{{ proc.schema_name }}</td>
                        <td>{{ proc.procedure_name }}</td>
                        <td>{{ proc.created | format_date }}</td>
                        <td>{{ proc.modified | format_date }}</td>
                        <td>{{ proc.description }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="functions" class="section">
        <h2>Functions</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Schema</th>
                        <th>Function Name</th>
                        <th>Type</th>
                        <th>Created</th>
                        <th>Modified</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for func in doc.functions %}
                    <tr>
                        <td>{{ func.schema_name }}</td>
                        <td>{{ func.function_name }}</td>
                        <td>{{ func.type }}</td>
                        <td>{{ func.created | format_date }}</td>
                        <td>{{ func.modified | format_date }}</td>
                        <td>{{ func.description }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="relationships" class="section">
        <h2>Database Relationships</h2>
        <p>Total Foreign Key Relationships: {{ doc.relationships.relationship_count }}</p>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Foreign Key</th>
                        <th>Parent Table</th>
                        <th>Parent Column</th>
                        <th>Referenced Table</th>
                        <th>Referenced Column</th>
                        <th>On Delete</th>
                        <th>On Update</th>
                    </tr>
                </thead>
                <tbody>
                    {% for fk in doc.relationships.foreign_keys %}
                    <tr>
                        <td>{{ fk.foreign_key_name }}</td>
                        <td>{{ fk.parent_schema }}.{{ fk.parent_table }}</td>
                        <td>{{ fk.parent_column }}</td>
                        <td>{{ fk.referenced_schema }}.{{ fk.referenced_table }}</td>
                        <td>{{ fk.referenced_column }}</td>
                        <td>{{ fk.on_delete }}</td>
                        <td>{{ fk.on_update }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #ddd; font-size: 0.9em; color: #666;">
        <p>Generated on {{ doc.metadata.extraction_date | format_date }} using Azure SQL Database Documentation Tool</p>
    </footer>
</body>
</html>